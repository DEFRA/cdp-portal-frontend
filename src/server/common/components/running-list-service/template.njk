{% from "tag/macro.njk" import appTag %}
{% from "time/macro.njk" import appTime %}
{% from "tool-tip/macro.njk" import appToolTip %}
{% from "icons/warning-icon/macro.njk" import appWarningIcon %}
{% from "icons/instance-success-icon/macro.njk" import appInstanceSuccessIcon %}
{% from "icons/instance-failed-icon/macro.njk" import appInstanceFailedIcon %}
{% from "icons/instance-pending-icon/macro.njk" import appInstancePendingIcon %}
{% from "icons/instance-stopped-icon/macro.njk" import appInstanceStoppedIcon %}

<section class="app-running-list-service">
  {% for envName in params.environments %}
    {% set runningService = params.runningServices | find({ environment: envName }) %}

    {% if runningService %}
      <div
        class="app-running-list-service__environment{% if runningService.statusClassname %} {{ runningService
        .statusClassname }}{% endif %}">
        <span class="app-running-list-service__label govuk-visually-hidden">Environment:</span>

        {% if runningService.unstable %}
          <p class="item item-unstable">
            {{ appWarningIcon({ classes: "app-icon--tiny", description: "Unstable!" }) }}
            Deployment unstable
          </p>
        {% endif %}

        <p class="item item-env">
          {{ appTag({ text: envName | title, classes: "app-tag--grey" }) }}
        </p>

        <p class="item item-status">
          {{ runningService.status | title }}
        </p>

        <p class="item item-version">
          <span class="app-running-list-service__label">Version:</span>
          <a class="app-link app-link--text-colour"
             href="https://github.com/DEFRA/{{ item.serviceName }}/releases/tag/{{ runningService.version }}"
             target="_blank" rel="noopener noreferrer">
            {{ runningService.version }}
          </a>
        </p>

        <p class="item item-deployed">
          <a class="app-link app-link--text-colour"
             href="/deployments/{{ envName }}/{{ runningService.cdpDeploymentId }}">
            Deployed
          </a> -
        </p>

        <p class="item item-updated">
          <time datetime="{{ runningService.updated }}">
            {{ runningService.updated | formatDistanceToNow }}
          </time>
          ago
        </p>
      </div>

    {% else %}

      <p class="app-running-list-service__zero-deployment{% if params.inverseZeroDeploy %}
      app-running-list-service__zero-deployment--inverse{% endif %}">
        {{ envName | title }}
      </p>

    {% endif %}
  {% endfor %}
</section>
