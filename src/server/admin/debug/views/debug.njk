{% extends "layouts/page.njk" %}

{% set infoHtml %}
  When you press submit the request will be displayed in a new tab. Allowing you to open multiple debug tabs with
  different parameter values.
{% endset %}

{% block content %}
  {% call appSplitPane({ isWide: true }) %}

    {{ appPageHeading({
      text: "Debug endpoints"
    }) }}

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">

        {{ appInfo({ html: infoHtml }) }}

        {% for route in debugRoutes %}

          {% call appPanel({
            classes: "govuk-!-margin-bottom-8" if loop.last
          }) %}
            <h2 class="govuk-heading-l govuk-!-margin-bottom-3">Endpoint</h2>
            <h2 class="govuk-heading-m govuk-!-display-inline">{{ route.method | upper }}</h2>
            <a class="app-link app-link--text-colour govuk-link" href="{{ route.path }}">{{ route.path }}</a>

            {% set urlParams = route.path.match('{(.*?)}') %}
            <form class="govuk-!-margin-top-2" action="/admin/debug/{{ route.path | urlencode }}" method="post"
                  target="_blank">
              <input type="hidden" name="csrfToken" value="{{ csrfToken }}"/>

              {% if urlParams %}

                <h2 class="govuk-heading-m govuk-!-margin-bottom-1">Url Params</h2>

                {{ govukInput({
                  id: urlParams[1] | lower,
                  name: "path-" +  urlParams[1],
                  label: {
                    text: urlParams[1],
                    classes: "app-label app-label--small govuk-!-margin-bottom-1"
                  },
                  classes: "app-input app-input--wide",
                  hint: {
                    text: "Enter the " + urlParams[1] + " url param value",
                    classes: "app-hint"
                  },
                  formGroup: {
                    classes: "app-form-group app-form-group--slim"
                  }
                }) }}
              {% endif %}

              {% if route.queryParams and route.queryParams.length %}

                <h2 class="govuk-heading-m govuk-!-margin-bottom-1">Query Params</h2>

                {% for queryParam in route.queryParams %}
                  {% set queryParamName = queryParam.name or queryParam %}

                  {{ govukInput({
                    id: "qp-" + loop.index + "-" + queryParamName,
                    name: "query-" + queryParamName,
                    label: {
                      text: queryParamName,
                      classes: "app-label app-label--small govuk-!-margin-bottom-1"
                    },
                    classes: "app-input app-input--wide",
                    hint: {
                      text: "Enter a value or comma-separated values. E.g. cat,pig,horse",
                      classes: "app-hint"
                    },
                    formGroup: {
                      classes: "app-form-group app-form-group--slim"
                    }
                  }) }}

                {% endfor %}
              {% endif %}

              {{ govukButton({
                classes: "app-button app-button--small",
                text: "Call endpoint"
              }) }}

            </form>
          {% endcall %}
        {% endfor %}

      </div>
    </div>
  {% endcall %}
{% endblock %}

