{% extends "layouts/tabbed-page.njk" %}

{% block beforeTabContent %}
  {{ appPageHeading({
    caption: "Automation",
    text: service.serviceName
  }) }}
{% endblock %}

{% block tabContent %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds-from-desktop">
      <section class="app-section--wide">
        <h2 class="govuk-heading-l govuk-!-margin-bottom-2">Auto Deploy</h2>

        <form
          action="{{ routeLookup('services/{serviceId}/automation/auto-deploy', { params: { serviceId : service.serviceName } }) }}"
          method="POST"
          data-js="app-form-group app-form-errors">
          <input type="hidden" name="csrfToken" value="{{ csrfToken }}" />

          <fieldset class="govuk-fieldset">
            <p>
              Turn on auto deploy in the following environments. Apart from prod, if an environment is not shown
              below it is because you are yet to deploy to it. Manually deploy, then come back here to turn on auto
              deploy for that environment.
            </p>

            {{ appInfo({
              classes: "govuk-!-margin-bottom-4",
              text: "Set up auto deployments to one or many environments. After you merge code into this services
                GitHub repositories default branch, we will auto deploy this service to the selected environments"
            }) }}

            {{ govukCheckboxes({
              name: "environments",
              classes: "app-checkboxes govuk-checkboxes--small",
              formGroup: {
                classes: "app-form-group"
              },
              items: autoDeployEnvironmentOptions,
              values: formValues.environments,
              errorMessage: {
                text: formErrors.environments.message
              } if formErrors.environments.message
            }) }}
          </fieldset>

          {{ govukButton({
            classes: "app-button",
            text: "Save"
          }) }}

        </form>
      </section>

    </div>
  </div>

{% endblock %}
