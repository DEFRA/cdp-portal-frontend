{% extends "layouts/tabbed-page.njk" %}

{% block beforeTabContent %}

  {{ appHeading({
    title: heading,
    caption: "Information about the " + heading + " microservice.",
    entities: headingEntities
  }) }}

{% endblock %}

{% block tabContent %}

  <div class="govuk-grid-row">
    <div class="app-grid-column-one-third-from-desktop-wide">

      {% call appSplitPane() %}
        <section class="govuk-!-margin-top-2 govuk-!-margin-left-2">
          <h2 class="govuk-heading-l govuk-!-margin-bottom-2">Update secret</h2>

          <form action="{{ routeLookup('post:services/{serviceId}/secrets/{environment}/update', {
            params: { serviceId: service.serviceName, environment: environment }
          }) }}" method="post" data-js="app-form-errors">
            <input type="hidden" name="csrfToken" value="{{ csrfToken }}" />
            <input type="hidden" name="teamId" value="{{ teamId }}" />
            <input type="hidden" name="secretKey" value="{{ secretKey }}" />

            {% call govukFieldset() %}

              {{ govukLabel({
                text: "Secret name",
                classes: "app-label"
              }) }}

              <p class="govuk-!-margin-bottom-6">{{ secretKey }}</p>

              {{ govukInput({
                id: "secret-value",
                name: "secretValue",
                label: {
                  text: "Secret value",
                  classes: "app-label"
                },
                classes: "app-input app-input--wide",
                hint: {
                  text: "Your secrets value",
                  classes: "app-hint"
                },
                formGroup: {
                  classes: "app-form-group app-form-group-js"
                },
                value: formValues.secretValue,
                errorMessage: {
                  text: formErrors.secretValue.message,
                  classes: "app-error-message",
                  attributes: {
                    "data-js": "app-error"
                  }
                } if formErrors.secretValue.message
              }) }}

              {{ govukLabel({
                text: "Environment",
                classes: "app-label"
              }) }}

              <p class="govuk-!-margin-bottom-6">{{ environment | title }}</p>

            {% endcall %}

            <div class="govuk-button-group">
              {{ govukButton({
                classes: "app-button",
                text: "Update",
                name: "button",
                value: "submit"
              }) }}

              <a class="govuk-link govuk-link--text-colour" href="{{ routeLookup
                ('services/{serviceId}/secrets/{environment}', {
                  params: {
                    serviceId,
                    environment
                  }
                }) }}">Cancel</a>
            </div>

          </form>
        </section>
      {% endcall %}

    </div>
  </div>

{% endblock %}
